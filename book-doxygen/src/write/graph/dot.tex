% 
% زبان ترسیم گراف Dot
% 
% در این بخش ابزار Dot مورد بررسی قرار گرفته است. این ابزار برای ترسیم گرافها و
% نمودارهای متفاوتی مورد استفاده قرار می‌گیرد.
% 
% \author ghasem
% \date تابستان ۱۳۹۱
%

\section{\lr{Dot}}
استفاده از \lr{Graphviz} در \lr{doxygen} 
برای طراحی و رسم نمودارها و گراف‌ها در مستندهای تولید شده توسط \lr{doxygen} می‌توان از ساختار \lr{Graphviz} استفاده کرد. بدین ترتیب با استفاده از قالب‌های از پیش تعریف شده در \lr{Graphviz} می توان به آسانی و تنها با وارد کردن چند کد ساده و با یک  ساختار مشخص، پیچیده‌ترین نمودارها مانند: نمودارهای طراحی شبکه، ساختمان داده، \lr{FSM} ، نمودارهای ژنتیک، سوئیجی، پردازشی و غیره را در مستند رسم کرد.
در \lr{Graphviz} ابزارهای مختلفی مانند \lr{dot, neato, smyrna, ...} وجود دارد. هر یک از ابزارهای فوق استفاده مخصوص به خود را دارند. در این بخش به بررسی ابزار \lr{dot} جهت رسم نمودار در مستند پرداخته می‌شود. با استفاده از یک زبان متنی ساده که \lr{Graphviz} در اختیار کاربر قرار می‌دهد، می‌توان پیچیده‌ترین گراف‌ها و نمودارها را تولید کرد. با توجه به این خصوصیت‌ها حتی می‌توان تولید نمودارهای خود را با توجه به داده‌های مورد نظر به صورت پویا درآورد.

\subsection{طراحی با \lr{dot}}
همانطور که بیان شد ابزار \lr{dot} جهت طراحی نمودارهای مختلف در یک مستند بکار برده می‌شود. برای طراحی یک نمودار می‌توان کدهای آن را مستقیما در مستند با قالب \lr{doxygen} وارد کرد. راه دیگر این است که طراحی را در فایلی جداگانه وارد کرده و در مکان مورد نیاز در مستند آن را فراخوانی کنید.
اگر بخواهید طراحی خود را مستقیم در مستند وارد کنید تا \lr{doxygen} بتواند کدهای گراف طراحی شده را بصورت نمودار در مستند تولید کند ابتدا باید به \lr{doxygen} بفهمانید که این بخش از مستند مربوط به رسم یک نمودار می‌باشد. برای اینکه \lr{doxygen} بتواند کدهای یک طراحی را به ابزار \lr{dot} ارسال کند و خروجی تصویر نمودار را به مستند اضافه کند باید کد مستند نمودار خود را در بین دو کلمه کلیدی
\lr{\textbackslash dot,\textbackslash enddot}
وارد کنید. ساختار وارد کردن کد نمودار طراحی شده در بین مستند بصورت زیر است.
\begin{C++}
/**
 * \dot
 * [Graph detail]
 * \enddot
 */
\end{C++}

یکی از روش‌های دیگری که می‌توان یک طراحی انجام شده بوسیله \lr{dot} را در مستند وارد کرد، فراخوانی خروجی یک نمودار طراحی شده به داخل مستند است. در این روش فایل کد نمودار طراحی شده که بر اساس قالب تعریفی ابزار \lr{dot} است، با استفاده از ساختار کلی زیر
\begin{C++}
/**
 *\dotfile <file> ["caption"]
 */
\end{C++}

قابل فراخوانی به داخل مستند می‌باشد. تفاوت این روش با روش قبل این است که در این روش لازم نیست کدهای طراحی انجام شده مستقیما در مستندها وارد شود. با توجه به ساختار تعریف شده، آرگومان اول شامل نام فایل حاوی کدهای گراف است و آرگومان دوم مخصوص زیرنویس تصویر و یا نام تصویر می‌باشد. البته باید یادآور شد که آرگومان دوم اختیاری است و می‌توان آن را حذف کرد.
%FIXME : یک مثال در اینجا آورده شود
در ضمن یادآور می‌شود که توسط ابزار \lr{dot} می‌توان تصویر نمودار را در قالب‌های مختلف مانند:
\lr{PNG, SVG, PDF, postscript}
تولید کرد.
\subsection{شئ‌ها در ابزار \lr{dot}}
بطور کلی زبان \lr{dot} سه نوع شئ را تعریف می‌کند که توسط آن‌ها می‌توان یک نمودار کامل را رسم کرد. این سه نوع شئ عبارتند از: گراف ها \lr{graph} ، گره‌ها \lr{nods} و لبه‌ها \lr{edges} . نمودار اصلی می تواند بصورت \lr{digraph} غیر مستقیم یا \lr{graph} مستقیم باشد. در طراحی یک نمودار اصلی یک زیر نمودار \lr{subgraph} می توان تعریف کرد که این زیرنمودار شامل مجموعه‌ای از گره‌ها و یال‌هاست.
%FIXME : یک مثال در اینجا آورده شود همراه با توصیف گره و کد نوشته شده
در ابتدای طراحی لازم است که ساختار اصلی طرح خود را مشخص کنید. ابتدا باید نوع گراف مورد نظر راتعیین کنید که از \lr{graph} یا \lr{digraph} است. سپس ساختار نمودار خود را بر اساس طرح با استفاده از گره‌ها و یال‌ها پیاده کنید.
برای طراحی یک نمودار لازم است تا گره‌ها و یال‌های را نامگذاری کرده و گره‌ها را بوسیله یال‌ها بهم متصل کرد. برای مشخص کردن یک گره کافی است که نام گره را تعیین کرده و در جلوی آن خصوصت‌های آن گره را بیاورید. تمام خصوصیت‌های یک گره در دو علامت [ , ] قرار می‌گیرد. پس از معرفی گره‌ها در یک طرح لازم است آن‌ها را بر اساس رابطه‌ای که باهم دارند توسط یال بهم متصل شوند. برای وصل کردن یک گره به گره دیگر از عملگر {<-} استفاده می‌شود. در دو طرف این عملگر گره‌هایی که بهم متصل خواهند شد.
%FIXME : یک مثال در اینجا آورده شود همراه با توصیف گره و کد نوشته شده
خصوصیت در یک طراحی شامل مجموعه تغییراتی است که می‌توان بر روی یک گره، یال،‌ گراف یا زیر گراف اعمال کرد. به امکانات ویژه‌ای که در اختیار طراح قرار داده شده تا بتواند طرح خود را پیاده کند خصوصیت گفته می‌شود. به هر خصوصیت می توان یک مقدار اختصاص داد. معمولا مقدار دهی یک خصوصیت با علامت (=) انجام می‌شود. بطور مثال با تغییر خصوصیت اندازه می‌‌توان اندازه یک گره، یال یا فونت و ... را تغییر داد. 
%FIXME : یک مثال در اینجا آورده شود همراه با توصیف و کد نوشته شده
برای دیدن لیست کامل خصوصیت‌ها می‌توانید به آدرس زیر مراجعه کنید.%TODO
\subsection{گره‌ و شکل‌های مختلف آن}
برای رسم یک گره می‌توان از شکل‌های مختلفی مانند: دایره، بیضی، لوزی و ... استفاده کرد. اگر شکل یک گره (خصوصیت \lr{shape} ) مقداردهی نشود آن گره بصورت پیش فرض بصورت بیضی رسم می‌شود. بطور معمول برای رسم یک گره ابتدا نام گره و سپس خصوصیت‌های آن در دو علامت ([]) قرار می‌گیرد. نام هر گره بوسیله برچسبی که به آن تخصیص داده می‌شود قابل شناسایی است.
\begin{webreference}
لیست تمام شکل‌های موجود برای نمایش یک گره در آدرس زیر آمده است.

\begin{latin}
http://www.graphviz.org/doc/info/shapes.html
\end{latin}
\end{webreference}

بطور کلی شکل‌های مختلف گره از دو گروه اصلی شامل: شکل‌های گوشه دار و رکوردها تشکیل شده است.
بطور مثال در کد گراف زیر گره \lr{main} با شکل یک جعبه رسم می شود. همانطور که بیان شد تمام خصوصیت‌های یک گره مانند: نوع شکل، اندازه، رنگ، برچسب و غیره در علامت‌های براکت قرار گرفته و مقداردهی می‌شود.
\begin{C++}
/**
* \dot
* digraph G {
* size ="4,4";
* main [shape=box];
*  /* this is a comment */
*  main -> parse [weight=8];
*  parse -> execute;
*  main -> init [style=dotted];
*  main -> cleanup;
*  execute -> { make_string; printf}
*  init -> make_string;
*  edge [color=red];
*  // so is this
*  main -> printf [style=bold,label="100 times"];
*  make_string [label="make a\nstring"];
*  node [shape=box,style=filled,color=".7 .3 1.0"];
*  execute -> compare;
* }
* \enddot
*/

\end{C++}
برای رسم مرز منحنی یک شکل بصورت چندتایی می‌توان از خصوصیت \lr{perpheries} استفاده کرد. با مقدار دهی این خصوصیت بصورت یک عدد صحیح مرز یک منحنی گره به تعداد دلخواه تکرار خواهد شد.
برای چرخش یک شکل بر حسب درجه می‌توان از خصوصیت \lr{orientation} استفاده کرد. سایر خصوصیت‌هایی دیگری مانند:
\lr{sides, skew, distortion,...} 
نیز وجود دارد که می‌توان بوسیله آن‌ها طراحی مورد نظر را انجام داد که در ادامه به برخی از آن‌ها اشاره می‌شود.

یکی از موارد مهم در طراحی یک نمودار یا گراف این است که باید بتوان به آسانی مکان گره یا یال‌ها را در طرح تعیین کرد. یک کاربر باید بتواند به آسانی مکان یک گره یا یال را به آسانی تعییر داده و آن را به مکان دلخواه خود انتقال دهد. برای تعیین مکان یک شئ می‌توان از خصوصیت‌های تعیین شده توسط ابزار \lr{dot} استفاده کرد.
%FIXME : یک مثال در اینجا آورده شود همراه با توصیف و کد نوشته شده
یکی از شکل‌های مهم گره‌ها رکورد است. گره‌های بصورت رکورد بر دو نوع هستند:
\lr{record, Mrecord}
بصورت گرافیکی یک رکورد به شکل یک مستطیل است که دارای فیلدهای داخلی بصورت افقی یا عمودی می‌باشد. \lr{Mrecord} از نظر شکل شبیه \lr{record} است با این تفاوت که  انتهای گوشه‌های آن بصورت گرد می‌باشد. با استفاده از براکت‌ {} می‌توان فیلدهای داخلی یک رکورد را بصورت عمودی یا افقی درآورد. بصورت پیش فرض فیلدهای تعریفی در یک رکورد بصورت افقی چیده می‌شوند. بطور مثال با معرفی چهار فیلد بصورت \lr{A|B|C|D} ، هر چهار فیلد بصورت افقی در کنار هم قرار می‌گیرند. اگر این چهار فیلد بصورت \lr{A | \{ B | C \} | D} معرفی شوند آنگاه دو فیلد \lr{B,C} بصورت عمودی روی هم قرار می‌گیرند و دو فیلد \lr{A,D} بصورت افقی در کنار آن‌ها می‌آیند.
ساختار بازگشتی بوسیله برچسب اختصاص داده شده به گره تعیین می‌شود. این ساختار دارای الگویی به صورت زیر می‌باشد.
\begin{equation}
 rlabel \rightarrow field('|'field)*
 field  \rightarrow boxLabel|"rlabel"
 boxLabel \rightarrow ['<'string'>'][string]
\end{equation}

% براکت، یک خط عمودی و علامت‌های بزرگتر و کوچکتر
اولین رشته در \lr{boxLabel} یک نام برای فیلد می‌گیرد. دومین رشته نیز برچسبی برای فیلد را تشکیل می‌دهد. دو فیلد چه به صورت عمودی و یا چه به صورت افقی باشد بوسیله یک خط عمودی از هم جدا می‌شوند. نام هر فیلد که بوسیله آن می‌توان به فیلد ارجا داد در دو علامت بزرگتر و کوچکتر (<>) قرار می‌گیرد.
یکی از موارد مهم دیگر در طراحی بر اساس رکوردها جهت رکورد است. با استفاده از خصوصیت \lr{rankdir} جهت گره‌هایی بصورت رکورد قابل تغییر است. اگر مقدار این خصوصیت \lr{TB} باشد (بصورت پیش فرض مقدار فوق به خصوصیت یاد شده اختصاص داده می‌شود.) جهت طرح بصورت عمودی قرار می‌گیرد و بالاترین سطح فیلدها در یک رکورد بصورت افقی نمایش داده می‌شود.
اگر مقدار خصوصیت فوق به \lr{LR} یا \lr{RL} نشانده شود، جهت طرح بصورت افقی تنظیم می‌شود و بالاترین سطح فیلدها در رکورد بصورت عمودی نمایش داده می‌شود.
با توجه به مثال زیر سه ساختار مختلف تعریف شده‌اند. هر ساختار دارای فیلدهایی است که هر فیلد دارای یک نام و برچسب می‌باشد. مثلا فیلد \lr{f0} دارای برچسب \lr{left} می‌باشد. در ادامه طراحی نیز فیلد \lr{f1} از \lr{struct1} توسط یالی به فیلد \lr{f0} از ساختار \lr{struct2} اشاره می‌کند.
\begin{C++}
/**
* \dot
* digraph structs { 
* node [shape=record];
* struct1 [label="<f0> left|<f1> mid\ dle|<f2> right"];
* struct2 [label="<f0> one|<f1> two"];
* struct3 [label="hello\nworld |{ b |{c|<here> d|e}| f}| g | h"];
* struct1:f1 -> struct2:f0;
* struct1:f2 -> struct3:here;
* }
* \enddot
*/
\end{C++}


%FIXME : یک شکل در اینجا آورده شود همراه با توصیف و کد نوشته شده
% \begin{C++}
% /**
%  * \msc
%  * [Diagram detail]
%  * \endmsc
%  */
% \end{C++}
\subsection{برچسب‌ها}
تا اینجا نحوه کلی رسم یک نمودار را بررسی کردیم. بصورت پیش فرض برچسب یک گره همان نام گره است. یال‌ها بصورت پیش فرض دارای برچسب نیستند. گره‌ها و برچسب‌ها را می‌توان بوسیله خصوصیت 
\lr{label}
برچسب‌گذاری کرد. برای ایجاد برچسب‌های چند خطی می‌توان دنباله‌ای از 
\lr{\textbackslash r, \textbackslash l, \textbackslash n}
را برای تنظیم چیدمان برچسب‌ها استفاده کرد. این چیدمان می‌تواند بصورت چپ چین، راست چین و یا مرکز یک شی باشد. برچسب یک گراف بصورت پیش‌فرض در مرکز و پایین گراف قرار می‌گیرد. برای قرار گرفتن برچسب در قسمت مرکز و بالای هر گراف از خصوصیت 
\lr{labelloc}
با مقدار \lr{t} استفاده می‌شود. مقدارهای \lr{b,r} بترتیب برای قرار گیری برچسب در قسمت پایین و در سمت راست مستطیل استفاده می‌شود. فونت پیش‌فرض با اندازه ۱۴ و \lr{Times Roman} با رنگ سیاه است. با استفاده از خصوصیت‌های 
\lr{fontname, fontsize, fontcolor} 
می‌توان هر یک از خصوصیت‌های نام، اندازه و رنگ فونت را به دلخواه تغییر داد. 
هنگامی که خروجی بصورت عکس با قالب‌هایی مانند: 
\lr{GIF, JPG}
باشد لازم نیست که فونت‌های بکار رفته برنامه درسترس باشند زیرا در هنگام نصب 
\lr{Graphviz}
بیشتر فونت‌های ضروری و پیش‌فرض در سیستم نصب می‌شوند.
محل قرار گیری برچسب مربوط به یال‌ها معمولا در سمت مرکز و نزدیک به یال قرار می‌گیرد. اما اگر حجم یک گراف افزایش یابد باید از بیرون زدگی یا قرار گرفتن برچسب بر روی یال‌‌های دیگر بخصوص در گراف‌های پیچیده اجتناب کرد. برای جلوگیری از چنین مشکلی معمولا در گراف‌های بزرگ برچسب یال‌ها بوسیله یک خط به یال وصل می‌شود. برای جلوگیری از چنین مشکلی از خصوصیت \lr{decorate} استفاده می‌شود که به مقدار \lr{true} نشانده می‌شود. بدین ترتیب در گراف‌های بزرگ وضوح معرفی یا برچسب گذاری یال‌ها بیشتر می‌شود.
برای وضوح بیشتر در معرفی یال همچنین می‌توان ابتدا و انتهای یک یال را برچسب گذاری کرد. برای برچسب گذاری ابتدای گره از خصوصیت \lr{headlabel} و برای برچسب گذاری انتهای یک یال از خصوصیت \lr{taillabel} استفاده می‌شود. 
برای یک برچسب علاوه بر خصوصیت‌های یاد شده خصوصیت‌هایی مانند 
\lr{labelfontname, labelfontcolor, labelfontsize, ...}
نیز وجود دارد که برای تغییر خصوصیت فوق مورد استفاده قرار می‌گیرد.
% \subsection{برچسب‌ها با قالب \lr{HTML}}

\subsection{قالب های گرافیکی}
برای طراحی یک گراف و استفاده از گره های مختلف توصیه می شود از رنگ هایی استفاده
شود که بتوان به راحتی برچسب ها، نام ها و ... را خواند. بطور مثال هنگامی که یک
گره را با یک رنگ پر می کنید باید رنگ فونت نام آن گره را با رنگ پر شده گره متضاد
باشد تا خواندن نام گره راحت باشد.
برای ابتدا یا انتهای هر یال می توان یک جهت مشخص کرد. خصوصیتی که باعث می شود هر
یک از دو سر یال یک جهت پیدا کند 
\lr{dir}
نام دارد. مقدار این خصوصیت می تواند:
\lr{forward, back, both, none}
باشد. هر یک از مقادیر فوق نشان دهنده جهت پیکانی است که به یک سر یا هر
دو سر یک یال اضافه می شود. این کار بیشتر برای خوانایی یک گراف انجام می شود و
وابستگی ها و وراثت ها را با وضوح بیشتری نشان می دهد. دو خصوصیت دیگر پیکان ها که
زیاد مورد استفاده قرار می گیرد خصوصیت های 
\lr{arrowhead,  arrowtail}
است. مقدارهای مجاز برای این خصوصیت ها شامل:
\lr{normal, inv, dot, invdot, odot, invodot, none }
می باشد. خصوصیت 
\lr{arrowsize}
برای تغییراندازه پیکان ها استفاده می شود. 
با توجه به تعریف رنگ و قالب می توان دسته دیگری از شی ها را اضافه کرد که رفتاری
شبیه به گره‌ها و یال‌ها دارند. این دسته بنام خوشه‌ها\footnote{\lr{cluster}}
معروف هستند. خوشه‌ها رفتاری شبیه گره ها دارند و به شکل یک مستطیل بزرگ هستند. هر خوشه
می تواند شامل چند گره همراه با یال‌های متصل باشد و آن‌ها را در بر گیرد.
\subsection{\lr{ Drawing Orientation, Size and Spacing}}
دو خصوصیتی که نقش مهمی در تعیین اندازه یک گراف طراحی شده \lr{dot} دارد خصوصیت
های \lr{nodesep, ranksep} هستند. خصوصیت اول بیان کننده کمترین فاصله (به اینچ)
بین دو گره مجاور هم رتبه است. دومین خصوصیت نیز بیان کننده فاصله عمودی بین
گره های هم رتبه است. این فاصله بر اساس فاصله بین دو انتهای گره‌ها و نوک آن گره
تا گره بعدی است. اگر خصوصیت \lr{ranksep} را به مقدار \lr{equally} نشانده شود،
تساوی فاصله بین گره‌ها تضمین می شود. معمولا با این مشکل مواجه شده اید که پس از
تهیه یک نمودار قصد دارید از نمودار خود یک نمونه چاپی تهیه کنید و یا آن را در یک
مستند خود قرار دهید اما اندازه نمودار بزرگتر از حد معمول است. در اینجا به نحوه
محاسبه اندازه طرح نهایی پرداخته می شود.
بصورت پیش فرض اندازه نمودار طراحی شده محدوده‌ی خاصی ندارد. بنابراین اگر اندازه
نمودار بزرگ‌تر از حد معمول شود اندازه طرح نهایی نیز بزرگتر خواهد شد.
یکی از ساده‌ترین راه‌ها برای تعیین اندازه یک طرح نشاندن مقدارهای مورد نظر
خصوصیت $size="x,y"$ است. با این مقدار دهی اندازه طرح نهایی قابل تنظیم است.
خصوصیت دیگری که بر روی تعیین اندازه طرح نهایی تاثیر گذار است خصوصیت \lr{ratio}.
با توجه به مطالب بیان شده حالت‌های مختلفی را می توان با مقداردهی دو خصوصیت
\lr{size, ratio}
طراحی کرد که در زیر آورده می شود.
\begin{itemize}
 \item اگر خصوصیت \lr{ratio} مقداردهی نشود. در این صورت اگر اندازه طراحی انجام
شده از قبل تعیین شده است هیچ تغییری در طرح نهایی اتفاق نمی افتد. در غیر اینصورت
طرح بصورت غیر معمولی گسترش می‌یابد. اما اگر خصوصیت فوق مقداردهی شود چهار حالت
زیر رخ می دهد.
\begin{itemize}
 \item 
\end{itemize}

\end{itemize}










